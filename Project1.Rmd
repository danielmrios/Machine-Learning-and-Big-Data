---
title: "Project 1"
output:
  pdf_document: default
  html_document: default
date: "2023-10-24"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(caret)
data <- read.csv("credit_fa2023_23.csv")
head(data,10)
names(data)
```
```{r}
crosstab <- table(data$NAME_CONTRACT_TYPE, data$TARGET)

crosstab_percent <- prop.table(crosstab, margin = 1) * 100

print(crosstab)
print(crosstab_percent)
```
Cash Loans * may * be better at predicting 1 than revolving loans

```{r}
contingency_table <- table(data$NAME_CONTRACT_TYPE, data$TARGET)

chi_square_test <- chisq.test(contingency_table)

# Print the test results
print(chi_square_test)
```
```{r}
categorical_vars <- c("NAME_CONTRACT_TYPE", "CODE_GENDER", "FLAG_OWN_CAR")
results <- data.frame(Variable = character(0), X2 = numeric(0), p_value = numeric(0))

for (var in categorical_vars) {
  contingency_table <- table(data[[var]], data$TARGET)
  chi_square_test <- chisq.test(contingency_table)
  results <- rbind(results, data.frame(Variable = var, X2 = chi_square_test$statistic, p_value = chi_square_test$p.value))
}
```
```{r}
categorical_vars <- c("NAME_CONTRACT_TYPE", "CODE_GENDER", "FLAG_OWN_CAR")
results <- data.frame(
  Variable = character(0),
  X2 = numeric(0),
  P_value_X2 = numeric(0),
  P_value_Fisher = numeric(0)
)

for (var in categorical_vars) {
  contingency_table <- table(data[[var]], data$TARGET)
  
  # Chi-squared test
  chi_square_test <- chisq.test(contingency_table)
  
  # Fisher's Exact Test
  fisher_test_result <- fisher.test(contingency_table)
  
  results <- rbind(results, data.frame(
    Variable = var,
    X2 = chi_square_test$statistic,
    P_value_X2 = chi_square_test$p.value,
    P_value_Fisher = fisher_test_result$p.value
  ))
}

# Display results
print(results)
```
```{r}
# Define the categorical variables you want to analyze
categorical_vars <- c("NAME_CONTRACT_TYPE", "CODE_GENDER", "FLAG_OWN_CAR")

# Create an empty list to store the results
results_list <- list()

# Loop through the categorical variables
for (var in categorical_vars) {
  # Create a contingency table
  crosstab <- table(data[[var]], data$TARGET)
  
  # Calculate the percentage
  crosstab_percent <- prop.table(crosstab, margin = 1) * 100
  
  # Store the results in a list
  results_list[[var]] <- list(
    Crosstab = crosstab,
    Crosstab_Percent = crosstab_percent
  )
}

# Print the results
for (var in categorical_vars) {
  cat("Variable:", var)
  print(results_list[[var]]$Crosstab)
  cat("\nPercentage:")
  print(results_list[[var]]$Crosstab_Percent)
  cat("\n")
}
```
```{r}
avg_risk = mean(data$TARGET)
print(avg_risk)

crosstab <- table(data$TARGET)
print(crosstab)
percent_0 <- (crosstab[1] / sum(crosstab)) * 100
percent_1 <- (crosstab[2] / sum(crosstab)) * 100

cat("Percentage of 0s: ", percent_0, "%\n")
cat("Percentage of 1s: ", percent_1, "%\n")
```
19.5% of individuals are labeled as high risk, lets compare that average to specific variables 

```{r}
categorical_vars <- c("NAME_CONTRACT_TYPE", "CODE_GENDER", "FLAG_OWN_CAR", "NAME_TYPE_SUITE", "NAME_INCOME_TYPE", "NAME_EDUCATION_TYPE", "NAME_FAMILY_STATUS", "NAME_HOUSING_TYPE", "FLAG_MOBIL", "FLAG_EMP_PHONE", "FLAG_WORK_PHONE", "FLAG_PHONE", "FLAG_EMAIL", "OCCUPATION_TYPE", "WEEKDAY_APPR_PROCESS_START", "REG_REGION_NOT_LIVE_REGION", "REG_REGION_NOT_WORK_REGION", "LIVE_REGION_NOT_WORK_REGION", "REG_CITY_NOT_LIVE_CITY", "REG_CITY_NOT_WORK_CITY", "LIVE_CITY_NOT_WORK_CITY", "ORGANIZATION_TYPE", "FLAG_DOCUMENT_2", "FLAG_DOCUMENT_3", "FLAG_DOCUMENT_4", "FLAG_DOCUMENT_5", "FLAG_DOCUMENT_6", "FLAG_DOCUMENT_7", "FLAG_DOCUMENT_8", "FLAG_DOCUMENT_9", "REGION_RATING_CLIENT_W_CITY", "FLAG_DOCUMENT_10", "FLAG_DOCUMENT_11", "FLAG_DOCUMENT_12", "FLAG_DOCUMENT_13", "FLAG_DOCUMENT_14", "FLAG_DOCUMENT_15", "FLAG_DOCUMENT_16", "FLAG_DOCUMENT_17", "FLAG_DOCUMENT_18", "FLAG_DOCUMENT_19", "FLAG_DOCUMENT_20", "FLAG_DOCUMENT_21")
```


```{r}
na_counts <- data.frame(Variable = character(0), NA_Count = numeric(0))

# Loop through the categorical variables
for (col in categorical_vars) {
  null_values <- sum(is.na(data[[col]])) # Count NA values
  na_counts <- rbind(na_counts, data.frame(Variable = col, NA_Count = null_values))
}

# Display the structured data frame
print(na_counts)
```



```{r}
# Create an empty list to store the results
results_list <- list()

# Loop through the categorical variables
for (var in categorical_vars) {
  # Create a contingency table
  crosstab <- table(data[[var]], data$TARGET)
  
  # Calculate the percentage
  crosstab_percent <- prop.table(crosstab, margin = 1) * 100
  
  # Store the results in a list
  results_list[[var]] <- list(
    Crosstab = crosstab,
    Crosstab_Percent = crosstab_percent
  )
}

# Print the results
for (var in categorical_vars) {
  cat("Variable:", var)
  print(results_list[[var]]$Crosstab)
  cat("\nPercentage:")
  print(results_list[[var]]$Crosstab_Percent)
  cat('\n')
}
```
```{r}
all_vars <- names(data)

results <- data.frame(
  Variable = character(0),
  X2 = numeric(0),
  P_value_X2 = numeric(0),
  P_value_Fisher = numeric(0)
)

for (var in all_vars) {
  contingency_table <- table(data[[var]], data$TARGET)
 
  chi_square_test <- chisq.test(contingency_table)
 
  if (min(dim(contingency_table)) <= 5) {
    fisher_test_result <- tryCatch(
      fisher.test(contingency_table),
      error = function(e) NULL
    )
  } else {
    fisher_test_result <- NULL
  }

  # Format the X2 column to display without scientific notation
  x2_formatted <- sprintf("%.1f", chi_square_test$statistic)

  results <- rbind(results, data.frame(
    Variable = var,
    X2 = as.numeric(x2_formatted),  # Update the X2 column with the formatted value
    P_value_X2 = chi_square_test$p.value,
    P_value_Fisher = ifelse(!is.null(fisher_test_result), fisher_test_result$p.value, NA)
  ))
}

# Display results
print(results)

```


